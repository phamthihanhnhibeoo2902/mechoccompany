<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mêchoc</title>
    <link rel="icon" href="../images/nama choco/2.jpg" type="image/x-icon">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <!-- Nội dung của trang web -->
    <header>
        <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-menu">
            <div class="container-fluid">
                <div class="row nav_container">
                    <div class="col-sm-2 d-block d-sm-none">
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    <div class="col-lg-7 col-sm-12 col-xs-12">
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a class="nav-link menu-item" href="../html/index.html" data-bs-toggle="">Mêchoc</a>

                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link menu-item" href="./mechoc.html" data-bs-toggle="dropdown">Menu</a>
                                    <ul class="dropdown-menu sub-menu">
                                        <li><a class="dropdown-item" href="./mechoc.html" data-gender="Nữ">Socola thanh  <span>&#9660;</span></a></a>
                                        </li>
                                        <li><a class="dropdown-item" href="./mechoc.html" data-gender="Nam">Bột cacao</a></li>
                                        <li><a class="dropdown-item" href="./mechoc.html" data-gender="Nam">Set event</a></li>
                                    </ul>
                                </li>

                                <li class="nav-item">
                                    <a class="nav-link menu-item" href="../html/gioithieu.html">CÂU CHUYỆN THƯƠNG HIỆU</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-5 col-sm-12 menu_right">
                        <ul class="navbar-nav" style="float: right;">
                            <li class="nav-item dropdown">
                                <a class="nav-link menu-item" href="./dangkithanhvien.html" data-bs-toggle="dropdown">TÀI KHOẢN</a>
                                <ul class="dropdown-menu sub-menu">
                                    <li><a class="dropdown-item" href="../html/dangkithanhvien.html">Đăng Ký</a></li>
                                    <li><a class="dropdown-item" href="../html/dangnhap.html">Đăng Nhập</a></li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown item_menu_right">
                                <a class="nav-link menu-item" href="./giohang.html"><i class="material-icons">shopping_cart</i></a>
                            </li>
                            <li class="nav-item dropdown item_menu_right">
                                <form action="./timkiem.html" id="Search">
                                    <input type="search" placeholder="Tìm kiếm loại nước hoa yêu thích của bạn">
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <!-- Giữ nguyên phần header ở đây -->

    <div class="container " style="margin-top: 4%;padding-top: 30px;">
        <section style="clear: both;">
            <div class="row">
                <div class="col-12">
                    <table class="table table-light">
                        <thead class="thead-light">
                            <tr>
                                <th>STT</th>
                                <th>Mêchoc</th>
                                <th>Hình ảnh</th>
                                <th>Số lượng</th>
                                <th>Giá</th>
                                <th>&nbsp;</th>
                            </tr>
                        </thead>
                        <tbody id="cart-table-body">
                            <!-- Các hàng sản phẩm sẽ được thêm vào đây -->
                        </tbody>
                    </table>

                    <div class="row">
                        <div class="col-7">
                            <form action="./dathangthanhcong.html" id="form_dangki" class="col-12">
                                <div class="form-group col-12">
                                    <input id="txt_phone" type="number" class="form-control" placeholder="Số điện thoại">
                                    <span class="text-danger" id="error_phone"></span>
                                </div>
                                <div class="form-group col-12">
                                    <input id="txt_address" type="text" class="form-control" placeholder="Địa chỉ">
                                    <span class="text-danger" id="error_address"></span>
                                </div>
                                <button type="submit" id="btn_dathang" class="btn btn-primary">Đặt hàng</button>
                            </form>
                            <div id="thongbao_loi" style="display: none;" class="alert alert-danger">
                                Vui Lòng Bạn Kiểm Tra Lại Nhé!
                            </div>
                        </div>

                        <div class="col-5" style="margin-top: 15px;">
                            <h2>Thông Tin Đơn Hàng Của Bạn</h2>
                            <table class="table table-light">
                                <thead class="thead-light">
                                    <tr>
                                        <th>Tổng Tiền:</th>
                                        <th id="total-amount" style="font-weight: bold; text-align: right;">0đ</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <footer>
        <div class="row">
            <div class="col-lg-4 col-sm-12 footer_element">
                <h5 style="margin-left: 50px;">
                    THÔNG TIN LIÊN HỆ
                </h5>
                <p style="margin-left: 50px; width: 500px;">
                    CÔNG TY CỔ PHẦN THƯƠNG MẠI DỊCH VỤ SẢN XUẤT MÊCHOC
                    <br>233A, Phan Văn Trị, Phường 11, Quận Bình Thạnh, Thành phố Hồ Chí Minh, Việt Nam
                    <br> (+84) 799654238
                    <br> MeChhoccompany@gmail.com
                    <br> wwww.Mechoccompany.com


                </p>
            </div>
            <div class="col-lg-4 col-sm-12 footer_element">
                <h5 style="margin-left: -35px; text-align: center;">
                    LIÊN KẾT
                </h5>
                <ul style="margin-left: -80px; text-align: center;">
                    <li><a href="./gioithieu.html">Câu chuyện thương hiệu</a></li>
                    <li><a href="./mechoc.html">Menu</a></li>
                    <li><a href="./index.html">Mêchoc </a></li>
                </ul>
            </div>
            <div class="col-lg-4 col-sm-12 footer_element">
                <h5 style="text-align: right; margin-right: 50px;">
                    CHÍNH SÁCH
                </h5>
                <ul style="margin-right: 50px; text-align: right;">
                    <li><a href="#">Chính Sách Bảo Hành</a></li>
                    <li><a href="#">Chính Sách Đổi Trả</a></li>
                    <li><a href="#">Tư Vấn Khách Hàng</a></li>
                    <img src="../images/nama choco/f18ede3b-c334-4de0-a953-8113298562f8.jpg" class="w-50">
                </ul>
            </div>
            <div class="col-lg-12 col-xs-12">
                <p style="text-align: center;color: rgb(241, 237, 237); margin-left: 10px;">

                </p>
            </div>
        </div>

    </footer>


    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            let totalAmount = 0;

            function renderCart() {
                let tableContent = '';
                totalAmount = 0;

                if (cart.length > 0) {
                    cart.forEach((product, index) => {
                        // Kiểm tra xem sản phẩm có giá sale hay không
                        const priceToShow = product.salePrice ? product.salePrice : product.price; // Nếu có giá sale thì hiển thị giá sale, không thì hiển thị giá gốc

                        // Cộng dồn tổng tiền
                        totalAmount += priceToShow * product.quantity;

                        tableContent += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${product.name}</td>
                                <td><img style="width: 100px; height: 100px;" src="${product.image}" alt="${product.name}" /></td>
                                <td>${product.quantity}</td>
                                <td>${priceToShow.toLocaleString('vi-VN')} VND</td> 
                                <td><button class="delete-btn" data-index="${index}" style="color:white;background-color:red">Delete</button></td>
                            </tr>
                        `;
                    });
                    $('#cart-table-body').html(tableContent);
                    $('#total-amount').text(totalAmount.toLocaleString('vi-VN') + ' VND'); // Hiển thị tổng tiền với định dạng
                } else {
                    $('#cart-table-body').html('<tr><td colspan="6">Giỏ hàng của bạn trống.</td></tr>');
                    $('#total-amount').text('0 VND');
                }
            }

            // Render cart when page loads
            renderCart();

            // Delete item from cart
            $(document).on('click', '.delete-btn', function() {
                const index = $(this).data('index');
                cart.splice(index, 1); // Xóa sản phẩm khỏi giỏ hàng
                localStorage.setItem('cart', JSON.stringify(cart)); // Cập nhật localStorage
                renderCart(); // Hiển thị lại giỏ hàng
            });

            $('#btn_dathang').on('click', function(e) {
                e.preventDefault();

                const phone = $('#txt_phone').val().trim();
                const address = $('#txt_address').val().trim();
                let isValid = true;

                if (!phone) {
                    $('#error_phone').text('Vui lòng nhập số điện thoại.');
                    isValid = false;
                } else {
                    $('#error_phone').text('');
                }

                if (!address) {
                    $('#error_address').text('Vui lòng nhập địa chỉ.');
                    isValid = false;
                } else {
                    $('#error_address').text('');
                }

                if (isValid) {
                    const orderID = 'DH' + Math.floor(100000 + Math.random() * 900000);
                    const order = {
                        orderID,
                        phone,
                        address,
                        cart,
                        totalAmount: totalAmount.toLocaleString('vi-VN') + ' VND', // Hiển thị tổng tiền với định dạng
                        date: new Date().toLocaleString()
                    };
                    localStorage.setItem('orderDetails', JSON.stringify(order));
                    window.location.href = './dathangthanhcong.html';
                } else {
                    $('#thongbao_loi').show().text('Vui lòng kiểm tra lại thông tin.');
                }
            });
        });
    </script>


</body>

</html>